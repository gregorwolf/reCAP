/*!
* OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/fl/registry/ChangeRegistry","sap/ui/thirdparty/jquery"],function(e,r){"use strict";var i={_mRegistrationPromises:{},_addRegistrationPromise:function(e,r){this._mRegistrationPromises[e]=r;r.then(function(){delete this._mRegistrationPromises[e]}.bind(this));r.catch(function(r){delete this._mRegistrationPromises[e];return Promise.reject(r)}.bind(this))},waitForChangeHandlerRegistration:function(e){return this._mRegistrationPromises[e]||Promise.resolve()},isChangeHandlerRegistrationInProgress:function(e){return!!this._mRegistrationPromises[e]},getChangeHandlersOfLoadedLibsAndRegisterOnNewLoadedLibs:function(){var e=sap.ui.getCore();var i=e.getLoadedLibraries();var t=[];r.each(i,function(e,r){if(r.extensions&&r.extensions.flChangeHandlers){t.push(this._registerFlexChangeHandlers(r.extensions.flChangeHandlers))}}.bind(this));e.attachLibraryChanged(this._handleLibraryRegistrationAfterFlexLibraryIsLoaded.bind(this));return Promise.all(t)},_registerFlexChangeHandlers:function(r){if(r){var i=e.getInstance();return i.registerControlsForChanges(r)}return Promise.resolve()},_handleLibraryRegistrationAfterFlexLibraryIsLoaded:function(e){if(e.getParameter("operation")==="add"){var r=e.getParameter("metadata");var i=r.sName;if(r&&r.extensions&&r.extensions.flChangeHandlers){var t=r.extensions.flChangeHandlers;var s=this._registerFlexChangeHandlers(t);this._addRegistrationPromise(i,s);return s}}return Promise.resolve()}};return i},true);