/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Component","sap/ui/core/util/reflection/BaseTreeModifier","sap/ui/thirdparty/hasher","sap/base/Log","sap/base/util/UriParameters","sap/base/util/uid","sap/base/strings/formatMessage","sap/ui/base/ManagedObject","sap/ui/core/mvc/View"],function(e,t,n,r,a,o,i,s,u,p){"use strict";function f(e){if(e.length>0&&e.indexOf(".Component")<0){e+=".Component"}return e}var c={APP_ID_AT_DESIGN_TIME:"${pro"+"ject.art"+"ifactId}",VARIANT_MODEL_NAME:"$FlexVariants",formatAndLogMessage:function(e,t,n,r){var o=t.join(" ");o=s(o,n);a[e](o,r||"")},getXSRFTokenFromControl:function(e){var t;if(!e){return""}if(e&&typeof e.getModel==="function"){t=e.getModel();return c._getXSRFTokenFromModel(t)}return""},_getXSRFTokenFromModel:function(e){var t;if(!e){return""}if(typeof e.getHeaders==="function"){t=e.getHeaders();if(t){return t["x-csrf-token"]}}return""},getComponentClassName:function(e){var t;if(e){t=this.getAppComponentForControl(e);if(t){var n=this._getComponentStartUpParameter(t,"sap-app-id");if(n){return n}if(t.getManifestEntry("sap.ui5")&&t.getManifestEntry("sap.ui5").appVariantId){return t.getManifestEntry("sap.ui5").appVariantId}}}return c.getComponentName(t)},isVariantByStartupParameter:function(e){if(e){var t=this.getAppComponentForControl(e);if(t){return!!this._getComponentStartUpParameter(t,"sap-app-id")}}return false},getAppComponentClassNameForComponent:function(e){return c.getComponentClassName(e)},getAppDescriptor:function(e){var t=null;var n=null;var r=null;if(e){n=this.getAppComponentForControl(e);if(n&&n.getMetadata){r=n.getMetadata();if(r&&r.getManifest){t=r.getManifest()}}}return t},getSiteId:function(e){var t=null;var n=null;if(e){n=this.getAppComponentForControl(e);if(n){t=this._getComponentStartUpParameter(n,"hcpApplicationId")}}return t},getSiteIdByComponentData:function(e){return this._getStartUpParameter(e,"hcpApplicationId")},isBinding:function(e){var t=false;if(e&&typeof e==="string"&&e.substring(0,1)==="{"&&e.slice(-1)==="}"){t=true}return t},isApplicationVariant:function(e){var t=c.getComponentClassName(e);var n=c.getAppComponentForControl(e);var r=c.getComponentName(n);return t!==r},isChangeRelatedToVariants:function(e){return e.getFileType()==="ctrl_variant_change"||e.getFileType()==="ctrl_variant_management_change"||e.getFileType()==="ctrl_variant"||e.getVariantReference()},isChangeRelatedToCompVariant:function(e){return e.getFileType()==="variant"||!!e.getSelector().persistencyKey},_getComponentStartUpParameter:function(e,t){var n=null;if(t){if(e&&e.getComponentData){n=this._getStartUpParameter(e.getComponentData(),t)}}return n},_getStartUpParameter:function(e,t){if(e&&e.startupParameters&&t){if(Array.isArray(e.startupParameters[t])){return e.startupParameters[t][0]}}},getComponentName:function(e){var t="";if(e){t=e.getMetadata().getName()}return f(t)},_getComponent:function(e){var n;if(e){n=t.get(e)}return n},_getComponentIdForControl:function(e){var t=c._getOwnerIdForControl(e);if(!t){if(e&&typeof e.getParent==="function"){var n=e.getParent();if(n){return c._getComponentIdForControl(n)}}}return t||""},getComponentForControl:function(e){return c._getComponentForControl(e)},getAppComponentForControl:function(e){var n=e instanceof t?e:this._getComponentForControl(e);return this._getAppComponentForComponent(n)},getAppDescriptorComponentObjectForControl:function(e){var t=this.getAppComponentForControl(e);var n=t.getManifest();return{name:this.getAppIdFromManifest(n)}},_getComponentForControl:function(e){var t=null;var n=null;if(e){n=c._getComponentIdForControl(e);if(n){t=c._getComponent(n)}}return t},_getAppComponentForComponent:function(e){var n=null;if(e&&e.getAppComponent&&e.getAppComponent()instanceof t){return e.getAppComponent()}if(e&&e.oComponentData&&e.oComponentData.appComponent){return e.oComponentData.appComponent}if(e&&e.getManifestEntry){n=e.getManifestEntry("sap.app")}else{return e}if(n&&n.type&&n.type!=="application"){if(e instanceof t){e=this._getComponentForControl(e)}return this.getAppComponentForControl(e)}return e},getViewForControl:function(e){return c.getFirstAncestorOfControlWithControlType(e,sap.ui.core.mvc.View)},getFirstAncestorOfControlWithControlType:function(e,t){if(e instanceof t){return e}if(e&&typeof e.getParent==="function"){e=e.getParent();return c.getFirstAncestorOfControlWithControlType(e,t)}},hasControlAncestorWithId:function(e,t){var n;if(e===t){return true}n=sap.ui.getCore().byId(e);while(n){if(n.getId()===t){return true}if(typeof n.getParent==="function"){n=n.getParent()}else{return false}}return false},_isView:function(e){return e instanceof p},_getOwnerIdForControl:function(e){return t.getOwnerIdFor(e)},getClient:function(){var e;var t;e=this._getUriParameters();t=e.get("sap-client");return t||undefined},_getUriParameters:function(){return o.fromQuery(window.location.search)},isHotfixMode:function(){var e;var t;e=this._getUriParameters();t=e.get("hotfix");return t==="true"},convertBrowserLanguageToISO639_1:function(e){if(!e||typeof e!=="string"){return""}var t=e.indexOf("-");if(t<0&&e.length<=2){return e.toUpperCase()}if(t>0&&t<=2){return e.substring(0,t).toUpperCase()}return""},getLrepUrl:function(){var e=sap.ui.getCore().getConfiguration().getFlexibilityServices();var t=e.find(function(e){return e.connector==="LrepConnector"});return t?t.url:""},getCurrentLanguage:function(){var e=sap.ui.getCore().getConfiguration().getLanguage();return c.convertBrowserLanguageToISO639_1(e)},getControlType:function(e){var t;if(e&&typeof e.getMetadata==="function"){t=e.getMetadata();if(t&&typeof t.getElementName==="function"){return t.getElementName()}}},asciiToString:function(t){var n=t.split(",");var r="";e.each(n,function(e,t){r+=String.fromCharCode(t)});return r},stringToAscii:function(e){var t="";for(var n=0;n<e.length;n++){t+=e.charCodeAt(n)+","}t=t.substring(0,t.length-1);return t},checkControlId:function(e,t){if(!t){e=e instanceof u?e:sap.ui.getCore().byId(e);t=c.getAppComponentForControl(e)}return n.checkControlId(e,t)},hasLocalIdSuffix:n.hasLocalIdSuffix,_getAllUrlParameters:function(){return window.location.search.substring(1)},getTechnicalParametersForComponent:function(e){return e&&e.getComponentData&&e.getComponentData()&&e.getComponentData().technicalParameters},getParsedURLHash:function(){return c.ifUShellContainerThen(function(e){var t=e[0].parseShellHash(r.getHash());return t||{}},["URLParsing"])||{}},ifUShellContainerThen:function(e,t){var n=c.getUshellContainer();if(n){var r=t.map(function(e){return n.getService(e)});return e(r)}},isDebugEnabled:function(){var e=this._getUriParameters();var t=e.get("sap-ui-debug")||"";if(sap.ui.getCore().getConfiguration().getDebug()||t==="true"){return true}var n=t.split(",");return n.indexOf("sap/ui/fl")!==-1||n.indexOf("sap/ui/fl/")!==-1},getUrlParameter:function(e){return o.fromQuery(window.location.search).get(e)},getUshellContainer:function(){return sap.ushell&&sap.ushell.Container},createDefaultFileName:function(e){var t=i().replace(/-/g,"_");if(e){t+="_"+e}return t},createNamespace:function(e,t){var n="changes";if(t==="ctrl_variant"){n="variants"}var r=e.reference.replace(".Component","");var a="apps/"+r+"/"+n+"/";return a},buildLrepRootNamespace:function(e,t,n){var r="apps/";var a=new Error("Error in sap.ui.fl.Utils#buildLrepRootNamespace: ");if(!e){a.message+="for every scenario you need a base ID";throw a}switch(t){case sap.ui.fl.Scenario.VersionedAppVariant:if(!n){a.message+="in a versioned app variant scenario you additionally need a project ID";throw a}r+=e+"/appVariants/"+n+"/";break;case sap.ui.fl.Scenario.AppVariant:if(!n){a.message+="in an app variant scenario you additionally need a project ID";throw a}r+=e+"/appVariants/"+n+"/";break;case sap.ui.fl.Scenario.AdaptationProject:if(!n){a.message+="in a adaptation project scenario you additionally need a project ID";throw a}r+=e+"/adapt/"+n+"/";break;case sap.ui.fl.Scenario.FioriElementsFromScratch:case sap.ui.fl.Scenario.UiAdaptation:default:r+=e+"/"}return r},_getComponentTypeFromManifest:function(e){return e&&e.getEntry&&e.getEntry("sap.app")&&e.getEntry("sap.app").type},_getComponentTypeFromRawManifest:function(e){return e&&e["sap.app"]&&e["sap.app"].type},isApplication:function(e,t){var n=t?c._getComponentTypeFromRawManifest(e):c._getComponentTypeFromManifest(e);return n==="application"},isApplicationComponent:function(e){return e instanceof t&&c.isApplication(e.getManifestObject())},isEmbeddedComponent:function(e){return e instanceof t&&c._getComponentTypeFromManifest(e.getManifestObject())==="component"},getFlexReference:function(e){if(e){if(e.getEntry("sap.ui5")){if(e.getEntry("sap.ui5").appVariantId){return e.getEntry("sap.ui5").appVariantId}if(e.getEntry("sap.ui5").componentName){return f(e.getEntry("sap.ui5").componentName)}}if(e.getEntry("sap.app")&&e.getEntry("sap.app").id){return f(c.getAppIdFromManifest(e))}}a.warning("No Manifest received.");return""},getAppIdFromManifest:function(e){if(e){var t=e.getEntry?e.getEntry("sap.app"):e["sap.app"];var n=t&&t.id;if(n===c.APP_ID_AT_DESIGN_TIME&&e.getComponentName){n=e.getComponentName()}return n}throw new Error("No Manifest received, descriptor changes are not possible")},getODataServiceUriFromManifest:function(e){var t="";if(e){var n=e.getEntry?e.getEntry("sap.app"):e["sap.app"];if(n&&n.dataSources&&n.dataSources.mainService&&n.dataSources.mainService.uri){t=n.dataSources.mainService.uri}}else{a.warning("No Manifest received.")}return t},indexOfObject:function(e,t){var n=-1;e.some(function(e,r){var a;var o;if(!e){a=[]}else{a=Object.keys(e)}if(!t){o=[]}else{o=Object.keys(t)}var i=a.length===o.length;var s=i&&!a.some(function(n){return e[n]!==t[n]});if(s){n=r}return s});return n},execPromiseQueueSequentially:function(e,t,n){if(e.length===0){if(n){return Promise.resolve()}return new c.FakePromise}var r=e.shift();if(typeof r==="function"){try{var o=r()}catch(e){o=Promise.reject(e)}return o.then(function(){if(!n&&o instanceof Promise){n=true}}).catch(function(e){var n="Error during execPromiseQueueSequentially processing occured";n+=e?": "+e.message:"";a.error(n);if(t){throw new Error(n)}}).then(function(){return this.execPromiseQueueSequentially(e,t,n)}.bind(this))}a.error("Changes could not be applied, promise not wrapped inside function.");return this.execPromiseQueueSequentially(e,t,n)},FakePromise:function(e,t,n){c.FakePromise.fakePromiseIdentifier="sap.ui.fl.Utils.FakePromise";this.vValue=e;this.vError=t;this.bContinueWithFakePromise=arguments.length<3||n===c.FakePromise.fakePromiseIdentifier;var r=function(e,t){try{var n=t(e,c.FakePromise.fakePromiseIdentifier);if(n instanceof Promise||n instanceof c.FakePromise){return n}return new c.FakePromise(n)}catch(e){var r=e;return new c.FakePromise(undefined,r)}};c.FakePromise.prototype.then=function(e){if(!this.bContinueWithFakePromise){return Promise.resolve(e(this.vValue))}if(!this.vError){return r(this.vValue,e)}return this};c.FakePromise.prototype.catch=function(e){if(!this.bContinueWithFakePromise){return Promise.reject(e(this.vError))}if(this.vError){return r(this.vError,e)}return this};if(this.vValue instanceof Promise||this.vValue instanceof c.FakePromise){return this.vValue}},getChangeFromChangesMap:function(e,t){var n;Object.keys(e).forEach(function(r){e[r].some(function(e){if(e.getId()===t){n=e;return true}})});return n},requireAsync:function(e){var t=sap.ui.require(e);if(t){return Promise.resolve(t)}return new Promise(function(t,n){sap.ui.require([e],function(e){t(e)},function(e){n(e)})})},normalizeReference:function(e){return e.replace(/(.Component)$/g,"")},handleUrlParameters:function(e,t,n){if(this.hasParameterAndValue(t,n)){if(e.startsWith("?")){e=e.substr(1,e.length)}var r=e.split("&").filter(function(e){return e!==t+"="+n});e="";if(r.length>0){e="?"+r.toString()}}else{e+=(e.length>0?"&":"?")+t+"="+n}return e},hasParameterAndValue:function(e,t){return this.getParameter(e)===t},getParameter:function(e){var t=this.getUshellContainer();if(t){var n=this.getParsedURLHash();return n.params&&n.params[e]&&n.params[e][0]}var r=o.fromQuery(document.location.search);if(!r){return false}return r.get(e)}};return c},true);