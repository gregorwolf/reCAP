/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/fl/write/_internal/connectors/ObjectPathConnector","sap/ui/fl/apply/_internal/connectors/ObjectStorageUtils"],function(e,t,r){"use strict";var i={};var n="sap.ui.fl";i.prototype={};i.enableFakeConnector=function(e){this.setFlexibilityServicesAndClearCache("LocalStorageConnector",e)};i.setFlexibilityServicesAndClearCache=function(e,r){this._oFlexibilityServices=sap.ui.getCore().getConfiguration().getFlexibilityServices();var i=[];if(r){t.setJsonPath(r);i.push({connector:"ObjectPathConnector"})}i.push({connector:e});sap.ui.getCore().getConfiguration().setFlexibilityServices(i);sap.ui.requireSync("sap/ui/fl/Cache").clearEntries()};i.disableFakeConnector=function(){i.prototype={};sap.ui.requireSync("sap/ui/fl/Cache").clearEntries();if(this._oFlexibilityServices){sap.ui.getCore().getConfiguration().setFlexibilityServices(this._oFlexibilityServices);delete this._oFlexibilityServices}};i.forTesting={getNumberOfChanges:function(e,t){return e.loadFlexData({reference:t}).then(function(e){return e.reduce(function(e,t){return e+t.changes.length},0)})},spyMethod:function(e,t,r,i){var n=e.spy(r,i);return function(e,r){r=r||0;var a=n.getCall(r).args[0].flexObjects.length;t.equal(a,e,i+" was called "+e+" times")}},clear:function(e,t){sap.ui.requireSync("sap/ui/fl/Cache").clearEntries();return e.reset(t)},setStorage:function(e,t){e.storage=t},synchronous:{clearAll:function(t){var r=function(e){var r=e.includes(n);if(!r){return}t.removeItem(e)};if(e.browser.msie){var i=t.length;for(var a=i-1;a>=0;a--){var s=t.key(a);r(s)}}else{Object.keys(t).map(r)}},store:function(e,t,i){var n=r.createFlexKey(t);var a=JSON.stringify(i);e.setItem(n,a)},getNumberOfChanges:function(e,t){var r=0;Object.keys(e).map(function(i){var a=i.includes(n);if(!a){return}var s=JSON.parse(e.getItem(i));if(s.reference===t||s.reference+".Component"===t){r++}});return r}}};return i},true);