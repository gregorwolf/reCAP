/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/File","sap/ui/core/util/reflection/JsControlTreeModifier","sap/m/MessageBox","sap/ui/thirdparty/jquery"],function(e,a,n,t){"use strict";var i={};i.VERSION="v1.0";i.extractData=function(e){var a={sVersion:i.VERSION,bIsInvestigationExport:true,mControlData:{},aAppliedChanges:[],aFailedChanges:[],aNotApplicableChanges:[],mChangesEntries:{},mVariantsChanges:{},sComponentName:e._mComponent.name};this._enhanceExportWithChangeData(e,a);this._enhanceExportWithVariantChangeData(e,a);this._enhanceExportWithControlData(e,a);return a};i.getAppComponentInstance=function(e){var a;var n=t.find(".sapUiComponentContainer");n.some(function(n){var t=sap.ui.getCore().byId(n.id);var i=t&&t.getComponentInstance();if(i&&i.getMetadata().getName()===e){a=i;return true}});return a};i._enhanceExportWithChangeData=function(e,n){var s=i.getAppComponentInstance(n.sComponentName);t.each(e._mChangesEntries,function(e,t){n.mChangesEntries[e]={mDefinition:t._oDefinition,aControlsDependencies:[],aDependencies:[]};if(t._aDependentSelectorList){t._aDependentSelectorList.forEach(function(e){var t={bPresent:!!a.bySelector(e,s),aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};n.mControlData[e.id]=t})}});this._enhanceExportWithDependencyData(e,n)};i._enhanceExportWithDependencyData=function(e,a){t.each(e._mChangesInitial.mDependencies,function(e,n){a.mChangesEntries[e].aControlsDependencies=n.controlsDependencies;a.mChangesEntries[e].aDependencies=n.dependencies})};i._enhanceExportWithVariantChangeData=function(e,a){t.each(e._mVariantsChanges,function(e,n){a.mVariantsChanges[e]={mDefinition:n._oDefinition}})};i._enhanceWithChangetypeSpecificData=function(e,a,n,t,i){if(i){n[t]=i;n[t].map(function(n){if(!(n in e[a])){e[a].push(n)}})}};i._getChangesForControlFromCustomData=function(e,a){var n=e.getCustomData();var t=[];n.forEach(function(e){var n=e.getKey();if(n.startsWith(a)){t.push(n.replace(a,""))}});return t};i._enhanceExportWithControlData=function(e,a){t.each(e._mChanges.mChanges,function(e){var n={bPresent:false,aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};var t=sap.ui.getCore().byId(e);if(t){n.bPresent=true;this._enhanceWithChangetypeSpecificData(a,"aAppliedChanges",n,"aAppliedChanges",this._getChangesForControlFromCustomData(t,"sap.ui.fl.appliedChanges."));this._enhanceWithChangetypeSpecificData(a,"aFailedChanges",n,"aFailedChangesJs",this._getChangesForControlFromCustomData(t,"sap.ui.fl.failedChanges.js."));this._enhanceWithChangetypeSpecificData(a,"aFailedChanges",n,"aFailedChangesXml",this._getChangesForControlFromCustomData(t,"sap.ui.fl.failedChanges.xml."));this._enhanceWithChangetypeSpecificData(a,"aNotApplicableChanges",n,"aNotApplicableChanges",this._getChangesForControlFromCustomData(t,"sap.ui.fl.notApplicableChanges."))}a.mControlData[e]=n}.bind(this))};i.createDownloadFile=function(a){try{var t=JSON.stringify(a);e.save(t,"flexibilityDataExtraction","json")}catch(e){n.error("The export of the flexibility data was not successful.\n"+e.message)}};return i});