/*!
* OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/each","sap/base/Log","sap/ui/fl/registry/ChangeRegistryItem","sap/ui/fl/registry/Settings","sap/ui/fl/requireAsync"],function(e,r,n,a,t){"use strict";var i={};var s={};var o={};var l={};function u(e,r){var n={};if(!r||!r.changeHandler){n.changeHandler=r}else{n=r}if(n.changeHandler==="default"){n.changeHandler=l.defaultChangeHandlers[e]}else if(Object.keys(l.developerChangeHandlers).includes(e)){throw Error("You can't use a custom change handler for the following Developer Mode change type: "+e+". Please use 'default' instead.")}return n}function c(r){o={};e(r,function(e,r){var t=new n({controlType:"defaultActiveForAll",changeHandler:r,layers:a.getDeveloperModeLayerPermissions(),changeType:e});o[e]=t})}function g(r,t,i){var s=Object.assign({},a.getDefaultLayerPermissions());if(i.layers){e(i.layers,function(e,r){if(s[e]===undefined){throw Error("The Layer '"+e+"' is not supported. Please only use supported layers")}s[e]=r})}var o={controlType:r,changeHandler:i.changeHandler,layers:s,changeType:t};return new n(o)}function f(e,r,n){var a=g(e,r,n);s[e]=s[e]||{};s[e][r]=a}function d(n,a){var i=Promise.resolve(a);var s="ChangeHandlerStorage.registerChangeHandlersForControl.skip_next_then";if(typeof a==="string"){i=t(a+".flexibility").catch(function(e){r.error("Flexibility change handler registration failed.\nControlType: "+n+"\n"+e.message);return Promise.resolve(s)})}return i.then(function(r){if(r!==s){e(r,function(e,r){var a=u(e,r);f(n,e,a)})}}).catch(function(e){r.error(e.message)})}i.registerPredefinedChangeHandlers=function(e,r){l.defaultChangeHandlers=e;l.developerChangeHandlers=r;c(r)};i.registerChangeHandlersForLibrary=function(r){var n=[];e(r,function(e,r){n.push(d(e,r))});return Promise.all(n)};i.getRegistryItem=function(e,r){return s[e]&&s[e][r]};i.getDeveloperModeChangeChangeRegistryItem=function(e){return o[e]};i.isChangeHandlerRegistered=function(e,r){return Object.keys(s[e]||{}).includes(r)};i.clearAll=function(){s={};o={};l={}};i.registerChangeHandlersForControl=function(e,r){return d(e,r)};return i});